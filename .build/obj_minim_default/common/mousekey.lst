   1               		.file	"mousekey.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__tmp_reg__ = 0
   6               	__zero_reg__ = 1
   7               		.text
   8               	.Ltext0:
   9               		.cfi_sections	.debug_frame
  10               		.section	.text.move_unit,"ax",@progbits
  12               	move_unit:
  13               	.LFB4:
  14               		.file 1 "tmk_core/common/mousekey.c"
   1:tmk_core/common/mousekey.c **** /*
   2:tmk_core/common/mousekey.c **** Copyright 2011 Jun Wako <wakojun@gmail.com>
   3:tmk_core/common/mousekey.c **** 
   4:tmk_core/common/mousekey.c **** This program is free software: you can redistribute it and/or modify
   5:tmk_core/common/mousekey.c **** it under the terms of the GNU General Public License as published by
   6:tmk_core/common/mousekey.c **** the Free Software Foundation, either version 2 of the License, or
   7:tmk_core/common/mousekey.c **** (at your option) any later version.
   8:tmk_core/common/mousekey.c **** 
   9:tmk_core/common/mousekey.c **** This program is distributed in the hope that it will be useful,
  10:tmk_core/common/mousekey.c **** but WITHOUT ANY WARRANTY; without even the implied warranty of
  11:tmk_core/common/mousekey.c **** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  12:tmk_core/common/mousekey.c **** GNU General Public License for more details.
  13:tmk_core/common/mousekey.c **** 
  14:tmk_core/common/mousekey.c **** You should have received a copy of the GNU General Public License
  15:tmk_core/common/mousekey.c **** along with this program.  If not, see <http://www.gnu.org/licenses/>.
  16:tmk_core/common/mousekey.c **** */
  17:tmk_core/common/mousekey.c **** 
  18:tmk_core/common/mousekey.c **** #include <stdint.h>
  19:tmk_core/common/mousekey.c **** #include "keycode.h"
  20:tmk_core/common/mousekey.c **** #include "host.h"
  21:tmk_core/common/mousekey.c **** #include "timer.h"
  22:tmk_core/common/mousekey.c **** #include "print.h"
  23:tmk_core/common/mousekey.c **** #include "debug.h"
  24:tmk_core/common/mousekey.c **** #include "mousekey.h"
  25:tmk_core/common/mousekey.c **** 
  26:tmk_core/common/mousekey.c **** inline int8_t times_inv_sqrt2(int8_t x) {
  27:tmk_core/common/mousekey.c ****     // 181/256 is pretty close to 1/sqrt(2)
  28:tmk_core/common/mousekey.c ****     // 0.70703125                 0.707106781
  29:tmk_core/common/mousekey.c ****     // 1 too small for x=99 and x=198
  30:tmk_core/common/mousekey.c ****     // This ends up being a mult and discard lower 8 bits
  31:tmk_core/common/mousekey.c ****     return (x * 181) >> 8;
  32:tmk_core/common/mousekey.c **** }
  33:tmk_core/common/mousekey.c **** 
  34:tmk_core/common/mousekey.c **** static report_mouse_t mouse_report = {0};
  35:tmk_core/common/mousekey.c **** static void           mousekey_debug(void);
  36:tmk_core/common/mousekey.c **** static uint8_t        mousekey_accel  = 0;
  37:tmk_core/common/mousekey.c **** static uint8_t        mousekey_repeat = 0;
  38:tmk_core/common/mousekey.c **** static uint16_t       last_timer      = 0;
  39:tmk_core/common/mousekey.c **** 
  40:tmk_core/common/mousekey.c **** #ifndef MK_3_SPEED
  41:tmk_core/common/mousekey.c **** 
  42:tmk_core/common/mousekey.c **** /*
  43:tmk_core/common/mousekey.c ****  * Mouse keys  acceleration algorithm
  44:tmk_core/common/mousekey.c ****  *  http://en.wikipedia.org/wiki/Mouse_keys
  45:tmk_core/common/mousekey.c ****  *
  46:tmk_core/common/mousekey.c ****  *  speed = delta * max_speed * (repeat / time_to_max)**((1000+curve)/1000)
  47:tmk_core/common/mousekey.c ****  */
  48:tmk_core/common/mousekey.c **** /* milliseconds between the initial key press and first repeated motion event (0-2550) */
  49:tmk_core/common/mousekey.c **** uint8_t mk_delay = MOUSEKEY_DELAY / 10;
  50:tmk_core/common/mousekey.c **** /* milliseconds between repeated motion events (0-255) */
  51:tmk_core/common/mousekey.c **** uint8_t mk_interval = MOUSEKEY_INTERVAL;
  52:tmk_core/common/mousekey.c **** /* steady speed (in action_delta units) applied each event (0-255) */
  53:tmk_core/common/mousekey.c **** uint8_t mk_max_speed = MOUSEKEY_MAX_SPEED;
  54:tmk_core/common/mousekey.c **** /* number of events (count) accelerating to steady speed (0-255) */
  55:tmk_core/common/mousekey.c **** uint8_t mk_time_to_max = MOUSEKEY_TIME_TO_MAX;
  56:tmk_core/common/mousekey.c **** /* ramp used to reach maximum pointer speed (NOT SUPPORTED) */
  57:tmk_core/common/mousekey.c **** // int8_t mk_curve = 0;
  58:tmk_core/common/mousekey.c **** /* wheel params */
  59:tmk_core/common/mousekey.c **** uint8_t mk_wheel_max_speed   = MOUSEKEY_WHEEL_MAX_SPEED;
  60:tmk_core/common/mousekey.c **** uint8_t mk_wheel_time_to_max = MOUSEKEY_WHEEL_TIME_TO_MAX;
  61:tmk_core/common/mousekey.c **** 
  62:tmk_core/common/mousekey.c **** static uint8_t move_unit(void) {
  15               		.loc 1 62 0
  16               		.cfi_startproc
  17               	/* prologue: function */
  18               	/* frame size = 0 */
  19               	/* stack size = 0 */
  20               	.L__stack_usage = 0
  63:tmk_core/common/mousekey.c ****     uint16_t unit;
  64:tmk_core/common/mousekey.c ****     if (mousekey_accel & (1 << 0)) {
  21               		.loc 1 64 0
  22 0000 8091 0000 		lds r24,mousekey_accel
  23 0004 80FF      		sbrs r24,0
  24 0006 00C0      		rjmp .L2
  65:tmk_core/common/mousekey.c ****         unit = (MOUSEKEY_MOVE_DELTA * mk_max_speed) / 4;
  25               		.loc 1 65 0
  26 0008 8091 0000 		lds r24,mk_max_speed
  27 000c 90E0      		ldi r25,0
  28 000e 65E0      		ldi r22,lo8(5)
  29 0010 70E0      		ldi r23,0
  30 0012 0E94 0000 		call __mulhi3
  31 0016 9595      		asr r25
  32 0018 8795      		ror r24
  33 001a 9595      		asr r25
  34 001c 8795      		ror r24
  35               	.LVL0:
  36 001e 00C0      		rjmp .L3
  37               	.LVL1:
  38               	.L2:
  66:tmk_core/common/mousekey.c ****     } else if (mousekey_accel & (1 << 1)) {
  39               		.loc 1 66 0
  40 0020 81FF      		sbrs r24,1
  41 0022 00C0      		rjmp .L4
  67:tmk_core/common/mousekey.c ****         unit = (MOUSEKEY_MOVE_DELTA * mk_max_speed) / 2;
  42               		.loc 1 67 0
  43 0024 8091 0000 		lds r24,mk_max_speed
  44 0028 90E0      		ldi r25,0
  45 002a 65E0      		ldi r22,lo8(5)
  46 002c 70E0      		ldi r23,0
  47 002e 0E94 0000 		call __mulhi3
  48 0032 9595      		asr r25
  49 0034 8795      		ror r24
  50               	.LVL2:
  51 0036 00C0      		rjmp .L3
  52               	.LVL3:
  53               	.L4:
  68:tmk_core/common/mousekey.c ****     } else if (mousekey_accel & (1 << 2)) {
  54               		.loc 1 68 0
  55 0038 82FF      		sbrs r24,2
  56 003a 00C0      		rjmp .L5
  57               	.L7:
  69:tmk_core/common/mousekey.c ****         unit = (MOUSEKEY_MOVE_DELTA * mk_max_speed);
  58               		.loc 1 69 0
  59 003c 8091 0000 		lds r24,mk_max_speed
  60 0040 90E0      		ldi r25,0
  61 0042 65E0      		ldi r22,lo8(5)
  62 0044 70E0      		ldi r23,0
  63 0046 0E94 0000 		call __mulhi3
  64               	.LVL4:
  65 004a 00C0      		rjmp .L3
  66               	.LVL5:
  67               	.L5:
  70:tmk_core/common/mousekey.c ****     } else if (mousekey_repeat == 0) {
  68               		.loc 1 70 0
  69 004c 2091 0000 		lds r18,mousekey_repeat
  70 0050 2223      		tst r18
  71 0052 01F0      		breq .L9
  71:tmk_core/common/mousekey.c ****         unit = MOUSEKEY_MOVE_DELTA;
  72:tmk_core/common/mousekey.c ****     } else if (mousekey_repeat >= mk_time_to_max) {
  72               		.loc 1 72 0
  73 0054 3091 0000 		lds r19,mk_time_to_max
  74 0058 2317      		cp r18,r19
  75 005a 00F4      		brsh .L7
  73:tmk_core/common/mousekey.c ****         unit = MOUSEKEY_MOVE_DELTA * mk_max_speed;
  74:tmk_core/common/mousekey.c ****     } else {
  75:tmk_core/common/mousekey.c ****         unit = (MOUSEKEY_MOVE_DELTA * mk_max_speed * mousekey_repeat) / mk_time_to_max;
  76               		.loc 1 75 0
  77 005c 8091 0000 		lds r24,mk_max_speed
  78 0060 90E0      		ldi r25,0
  79 0062 65E0      		ldi r22,lo8(5)
  80 0064 70E0      		ldi r23,0
  81 0066 0E94 0000 		call __mulhi3
  82 006a 622F      		mov r22,r18
  83 006c 70E0      		ldi r23,0
  84 006e 0E94 0000 		call __mulhi3
  85 0072 632F      		mov r22,r19
  86 0074 70E0      		ldi r23,0
  87 0076 0E94 0000 		call __divmodhi4
  88 007a CB01      		movw r24,r22
  89               	.LVL6:
  90               	.L3:
  76:tmk_core/common/mousekey.c ****     }
  77:tmk_core/common/mousekey.c ****     return (unit > MOUSEKEY_MOVE_MAX ? MOUSEKEY_MOVE_MAX : (unit == 0 ? 1 : unit));
  91               		.loc 1 77 0
  92 007c 8038      		cpi r24,-128
  93 007e 9105      		cpc r25,__zero_reg__
  94 0080 00F4      		brsh .L10
  95               		.loc 1 77 0 is_stmt 0 discriminator 1
  96 0082 0097      		sbiw r24,0
  97 0084 01F4      		brne .L8
  98               		.loc 1 77 0
  99 0086 81E0      		ldi r24,lo8(1)
 100               	.LVL7:
 101 0088 00C0      		rjmp .L8
 102               	.L9:
  71:tmk_core/common/mousekey.c ****     } else if (mousekey_repeat >= mk_time_to_max) {
 103               		.loc 1 71 0 is_stmt 1
 104 008a 85E0      		ldi r24,lo8(5)
 105 008c 90E0      		ldi r25,0
 106 008e 0895      		ret
 107               	.LVL8:
 108               	.L10:
 109               		.loc 1 77 0
 110 0090 8FE7      		ldi r24,lo8(127)
 111               	.LVL9:
 112 0092 0895      		ret
 113               	.L8:
  78:tmk_core/common/mousekey.c **** }
 114               		.loc 1 78 0 discriminator 8
 115 0094 0895      		ret
 116               		.cfi_endproc
 117               	.LFE4:
 119               		.section	.text.wheel_unit,"ax",@progbits
 121               	wheel_unit:
 122               	.LFB5:
  79:tmk_core/common/mousekey.c **** 
  80:tmk_core/common/mousekey.c **** static uint8_t wheel_unit(void) {
 123               		.loc 1 80 0
 124               		.cfi_startproc
 125               	/* prologue: function */
 126               	/* frame size = 0 */
 127               	/* stack size = 0 */
 128               	.L__stack_usage = 0
  81:tmk_core/common/mousekey.c ****     uint16_t unit;
  82:tmk_core/common/mousekey.c ****     if (mousekey_accel & (1 << 0)) {
 129               		.loc 1 82 0
 130 0000 8091 0000 		lds r24,mousekey_accel
 131 0004 80FF      		sbrs r24,0
 132 0006 00C0      		rjmp .L14
  83:tmk_core/common/mousekey.c ****         unit = (MOUSEKEY_WHEEL_DELTA * mk_wheel_max_speed) / 4;
 133               		.loc 1 83 0
 134 0008 6091 0000 		lds r22,mk_wheel_max_speed
 135 000c 70E0      		ldi r23,0
 136 000e 7595      		asr r23
 137 0010 6795      		ror r22
 138 0012 7595      		asr r23
 139 0014 6795      		ror r22
 140               	.LVL10:
 141 0016 00C0      		rjmp .L22
 142               	.LVL11:
 143               	.L14:
  84:tmk_core/common/mousekey.c ****     } else if (mousekey_accel & (1 << 1)) {
 144               		.loc 1 84 0
 145 0018 81FF      		sbrs r24,1
 146 001a 00C0      		rjmp .L16
  85:tmk_core/common/mousekey.c ****         unit = (MOUSEKEY_WHEEL_DELTA * mk_wheel_max_speed) / 2;
 147               		.loc 1 85 0
 148 001c 6091 0000 		lds r22,mk_wheel_max_speed
 149 0020 70E0      		ldi r23,0
 150 0022 7595      		asr r23
 151 0024 6795      		ror r22
 152               	.LVL12:
 153 0026 00C0      		rjmp .L22
 154               	.LVL13:
 155               	.L16:
  86:tmk_core/common/mousekey.c ****     } else if (mousekey_accel & (1 << 2)) {
 156               		.loc 1 86 0
 157 0028 82FF      		sbrs r24,2
 158 002a 00C0      		rjmp .L17
 159               	.L20:
  87:tmk_core/common/mousekey.c ****         unit = (MOUSEKEY_WHEEL_DELTA * mk_wheel_max_speed);
 160               		.loc 1 87 0
 161 002c 6091 0000 		lds r22,mk_wheel_max_speed
 162 0030 70E0      		ldi r23,0
 163               	.LVL14:
 164 0032 00C0      		rjmp .L18
 165               	.LVL15:
 166               	.L17:
  88:tmk_core/common/mousekey.c ****     } else if (mousekey_repeat == 0) {
 167               		.loc 1 88 0
 168 0034 6091 0000 		lds r22,mousekey_repeat
 169 0038 6623      		tst r22
 170 003a 01F0      		breq .L23
  89:tmk_core/common/mousekey.c ****         unit = MOUSEKEY_WHEEL_DELTA;
  90:tmk_core/common/mousekey.c ****     } else if (mousekey_repeat >= mk_wheel_time_to_max) {
 171               		.loc 1 90 0
 172 003c 2091 0000 		lds r18,mk_wheel_time_to_max
 173 0040 6217      		cp r22,r18
 174 0042 00F4      		brsh .L20
  91:tmk_core/common/mousekey.c ****         unit = MOUSEKEY_WHEEL_DELTA * mk_wheel_max_speed;
  92:tmk_core/common/mousekey.c ****     } else {
  93:tmk_core/common/mousekey.c ****         unit = (MOUSEKEY_WHEEL_DELTA * mk_wheel_max_speed * mousekey_repeat) / mk_wheel_time_to_max
 175               		.loc 1 93 0
 176 0044 8091 0000 		lds r24,mk_wheel_max_speed
 177 0048 70E0      		ldi r23,0
 178 004a 90E0      		ldi r25,0
 179 004c 0E94 0000 		call __mulhi3
 180 0050 622F      		mov r22,r18
 181 0052 70E0      		ldi r23,0
 182 0054 0E94 0000 		call __divmodhi4
 183               	.LVL16:
 184               	.L18:
  94:tmk_core/common/mousekey.c ****     }
  95:tmk_core/common/mousekey.c ****     return (unit > MOUSEKEY_WHEEL_MAX ? MOUSEKEY_WHEEL_MAX : (unit == 0 ? 1 : unit));
 185               		.loc 1 95 0
 186 0058 6038      		cpi r22,-128
 187 005a 7105      		cpc r23,__zero_reg__
 188 005c 00F4      		brsh .L24
 189               	.L22:
 190               		.loc 1 95 0 is_stmt 0 discriminator 1
 191 005e 6115      		cp r22,__zero_reg__
 192 0060 7105      		cpc r23,__zero_reg__
 193 0062 01F4      		brne .L19
 194 0064 00C0      		rjmp .L26
 195               	.LVL17:
 196               	.L23:
  89:tmk_core/common/mousekey.c ****     } else if (mousekey_repeat >= mk_wheel_time_to_max) {
 197               		.loc 1 89 0 is_stmt 1
 198 0066 61E0      		ldi r22,lo8(1)
 199 0068 70E0      		ldi r23,0
 200               	.L19:
 201               		.loc 1 95 0 discriminator 3
 202 006a 862F      		mov r24,r22
 203 006c 0895      		ret
 204               	.LVL18:
 205               	.L24:
 206               		.loc 1 95 0 is_stmt 0
 207 006e 8FE7      		ldi r24,lo8(127)
 208 0070 0895      		ret
 209               	.L26:
 210 0072 81E0      		ldi r24,lo8(1)
  96:tmk_core/common/mousekey.c **** }
 211               		.loc 1 96 0 is_stmt 1
 212 0074 0895      		ret
 213               		.cfi_endproc
 214               	.LFE5:
 216               		.section	.text.mousekey_on,"ax",@progbits
 217               	.global	mousekey_on
 219               	mousekey_on:
 220               	.LFB7:
  97:tmk_core/common/mousekey.c **** 
  98:tmk_core/common/mousekey.c **** void mousekey_task(void) {
  99:tmk_core/common/mousekey.c ****     if (timer_elapsed(last_timer) < (mousekey_repeat ? mk_interval : mk_delay * 10)) {
 100:tmk_core/common/mousekey.c ****         return;
 101:tmk_core/common/mousekey.c ****     }
 102:tmk_core/common/mousekey.c ****     if (mouse_report.x == 0 && mouse_report.y == 0 && mouse_report.v == 0 && mouse_report.h == 0) {
 103:tmk_core/common/mousekey.c ****         return;
 104:tmk_core/common/mousekey.c ****     }
 105:tmk_core/common/mousekey.c ****     if (mousekey_repeat != UINT8_MAX) mousekey_repeat++;
 106:tmk_core/common/mousekey.c ****     if (mouse_report.x > 0) mouse_report.x = move_unit();
 107:tmk_core/common/mousekey.c ****     if (mouse_report.x < 0) mouse_report.x = move_unit() * -1;
 108:tmk_core/common/mousekey.c ****     if (mouse_report.y > 0) mouse_report.y = move_unit();
 109:tmk_core/common/mousekey.c ****     if (mouse_report.y < 0) mouse_report.y = move_unit() * -1;
 110:tmk_core/common/mousekey.c ****     /* diagonal move [1/sqrt(2)] */
 111:tmk_core/common/mousekey.c ****     if (mouse_report.x && mouse_report.y) {
 112:tmk_core/common/mousekey.c ****         mouse_report.x = times_inv_sqrt2(mouse_report.x);
 113:tmk_core/common/mousekey.c ****         if (mouse_report.x == 0) {
 114:tmk_core/common/mousekey.c ****             mouse_report.x = 1;
 115:tmk_core/common/mousekey.c ****         }
 116:tmk_core/common/mousekey.c ****         mouse_report.y = times_inv_sqrt2(mouse_report.y);
 117:tmk_core/common/mousekey.c ****         if (mouse_report.y == 0) {
 118:tmk_core/common/mousekey.c ****             mouse_report.y = 1;
 119:tmk_core/common/mousekey.c ****         }
 120:tmk_core/common/mousekey.c ****     }
 121:tmk_core/common/mousekey.c ****     if (mouse_report.v > 0) mouse_report.v = wheel_unit();
 122:tmk_core/common/mousekey.c ****     if (mouse_report.v < 0) mouse_report.v = wheel_unit() * -1;
 123:tmk_core/common/mousekey.c ****     if (mouse_report.h > 0) mouse_report.h = wheel_unit();
 124:tmk_core/common/mousekey.c ****     if (mouse_report.h < 0) mouse_report.h = wheel_unit() * -1;
 125:tmk_core/common/mousekey.c ****     mousekey_send();
 126:tmk_core/common/mousekey.c **** }
 127:tmk_core/common/mousekey.c **** 
 128:tmk_core/common/mousekey.c **** void mousekey_on(uint8_t code) {
 221               		.loc 1 128 0
 222               		.cfi_startproc
 223               	.LVL19:
 224               	/* prologue: function */
 225               	/* frame size = 0 */
 226               	/* stack size = 0 */
 227               	.L__stack_usage = 0
 129:tmk_core/common/mousekey.c ****     if (code == KC_MS_UP)
 228               		.loc 1 129 0
 229 0000 803F      		cpi r24,lo8(-16)
 230 0002 01F4      		brne .L28
 130:tmk_core/common/mousekey.c ****         mouse_report.y = move_unit() * -1;
 231               		.loc 1 130 0
 232 0004 0E94 0000 		call move_unit
 233               	.LVL20:
 234 0008 8195      		neg r24
 235 000a 00C0      		rjmp .L44
 236               	.LVL21:
 237               	.L28:
 131:tmk_core/common/mousekey.c ****     else if (code == KC_MS_DOWN)
 238               		.loc 1 131 0
 239 000c 813F      		cpi r24,lo8(-15)
 240 000e 01F4      		brne .L30
 132:tmk_core/common/mousekey.c ****         mouse_report.y = move_unit();
 241               		.loc 1 132 0
 242 0010 0E94 0000 		call move_unit
 243               	.LVL22:
 244               	.L44:
 245 0014 8093 0000 		sts mouse_report+3,r24
 246 0018 0895      		ret
 247               	.LVL23:
 248               	.L30:
 133:tmk_core/common/mousekey.c ****     else if (code == KC_MS_LEFT)
 249               		.loc 1 133 0
 250 001a 823F      		cpi r24,lo8(-14)
 251 001c 01F4      		brne .L31
 134:tmk_core/common/mousekey.c ****         mouse_report.x = move_unit() * -1;
 252               		.loc 1 134 0
 253 001e 0E94 0000 		call move_unit
 254               	.LVL24:
 255 0022 8195      		neg r24
 256 0024 00C0      		rjmp .L46
 257               	.LVL25:
 258               	.L31:
 135:tmk_core/common/mousekey.c ****     else if (code == KC_MS_RIGHT)
 259               		.loc 1 135 0
 260 0026 833F      		cpi r24,lo8(-13)
 261 0028 01F4      		brne .L32
 136:tmk_core/common/mousekey.c ****         mouse_report.x = move_unit();
 262               		.loc 1 136 0
 263 002a 0E94 0000 		call move_unit
 264               	.LVL26:
 265               	.L46:
 266 002e 8093 0000 		sts mouse_report+2,r24
 267 0032 0895      		ret
 268               	.LVL27:
 269               	.L32:
 137:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_UP)
 270               		.loc 1 137 0
 271 0034 893F      		cpi r24,lo8(-7)
 272 0036 01F4      		brne .L33
 138:tmk_core/common/mousekey.c ****         mouse_report.v = wheel_unit();
 273               		.loc 1 138 0
 274 0038 0E94 0000 		call wheel_unit
 275               	.LVL28:
 276 003c 00C0      		rjmp .L48
 277               	.LVL29:
 278               	.L33:
 139:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_DOWN)
 279               		.loc 1 139 0
 280 003e 8A3F      		cpi r24,lo8(-6)
 281 0040 01F4      		brne .L34
 140:tmk_core/common/mousekey.c ****         mouse_report.v = wheel_unit() * -1;
 282               		.loc 1 140 0
 283 0042 0E94 0000 		call wheel_unit
 284               	.LVL30:
 285 0046 8195      		neg r24
 286               	.L48:
 287 0048 8093 0000 		sts mouse_report+4,r24
 288 004c 0895      		ret
 289               	.LVL31:
 290               	.L34:
 141:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_LEFT)
 291               		.loc 1 141 0
 292 004e 8B3F      		cpi r24,lo8(-5)
 293 0050 01F4      		brne .L35
 142:tmk_core/common/mousekey.c ****         mouse_report.h = wheel_unit() * -1;
 294               		.loc 1 142 0
 295 0052 0E94 0000 		call wheel_unit
 296               	.LVL32:
 297 0056 8195      		neg r24
 298 0058 00C0      		rjmp .L49
 299               	.LVL33:
 300               	.L35:
 143:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_RIGHT)
 301               		.loc 1 143 0
 302 005a 8C3F      		cpi r24,lo8(-4)
 303 005c 01F4      		brne .L36
 144:tmk_core/common/mousekey.c ****         mouse_report.h = wheel_unit();
 304               		.loc 1 144 0
 305 005e 0E94 0000 		call wheel_unit
 306               	.LVL34:
 307               	.L49:
 308 0062 8093 0000 		sts mouse_report+5,r24
 309 0066 0895      		ret
 310               	.LVL35:
 311               	.L36:
 145:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN1)
 312               		.loc 1 145 0
 313 0068 843F      		cpi r24,lo8(-12)
 314 006a 01F4      		brne .L37
 146:tmk_core/common/mousekey.c ****         mouse_report.buttons |= MOUSE_BTN1;
 315               		.loc 1 146 0
 316 006c 8091 0000 		lds r24,mouse_report+1
 317               	.LVL36:
 318 0070 8160      		ori r24,lo8(1)
 319 0072 00C0      		rjmp .L47
 320               	.LVL37:
 321               	.L37:
 147:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN2)
 322               		.loc 1 147 0
 323 0074 853F      		cpi r24,lo8(-11)
 324 0076 01F4      		brne .L38
 148:tmk_core/common/mousekey.c ****         mouse_report.buttons |= MOUSE_BTN2;
 325               		.loc 1 148 0
 326 0078 8091 0000 		lds r24,mouse_report+1
 327               	.LVL38:
 328 007c 8260      		ori r24,lo8(2)
 329 007e 00C0      		rjmp .L47
 330               	.LVL39:
 331               	.L38:
 149:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN3)
 332               		.loc 1 149 0
 333 0080 863F      		cpi r24,lo8(-10)
 334 0082 01F4      		brne .L39
 150:tmk_core/common/mousekey.c ****         mouse_report.buttons |= MOUSE_BTN3;
 335               		.loc 1 150 0
 336 0084 8091 0000 		lds r24,mouse_report+1
 337               	.LVL40:
 338 0088 8460      		ori r24,lo8(4)
 339 008a 00C0      		rjmp .L47
 340               	.LVL41:
 341               	.L39:
 151:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN4)
 342               		.loc 1 151 0
 343 008c 873F      		cpi r24,lo8(-9)
 344 008e 01F4      		brne .L40
 152:tmk_core/common/mousekey.c ****         mouse_report.buttons |= MOUSE_BTN4;
 345               		.loc 1 152 0
 346 0090 8091 0000 		lds r24,mouse_report+1
 347               	.LVL42:
 348 0094 8860      		ori r24,lo8(8)
 349 0096 00C0      		rjmp .L47
 350               	.LVL43:
 351               	.L40:
 153:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN5)
 352               		.loc 1 153 0
 353 0098 883F      		cpi r24,lo8(-8)
 354 009a 01F4      		brne .L41
 154:tmk_core/common/mousekey.c ****         mouse_report.buttons |= MOUSE_BTN5;
 355               		.loc 1 154 0
 356 009c 8091 0000 		lds r24,mouse_report+1
 357               	.LVL44:
 358 00a0 8061      		ori r24,lo8(16)
 359               	.L47:
 360 00a2 8093 0000 		sts mouse_report+1,r24
 361 00a6 0895      		ret
 362               	.LVL45:
 363               	.L41:
 155:tmk_core/common/mousekey.c ****     else if (code == KC_MS_ACCEL0)
 364               		.loc 1 155 0
 365 00a8 8D3F      		cpi r24,lo8(-3)
 366 00aa 01F4      		brne .L42
 156:tmk_core/common/mousekey.c ****         mousekey_accel |= (1 << 0);
 367               		.loc 1 156 0
 368 00ac 8091 0000 		lds r24,mousekey_accel
 369               	.LVL46:
 370 00b0 8160      		ori r24,lo8(1)
 371 00b2 00C0      		rjmp .L45
 372               	.LVL47:
 373               	.L42:
 157:tmk_core/common/mousekey.c ****     else if (code == KC_MS_ACCEL1)
 374               		.loc 1 157 0
 375 00b4 8E3F      		cpi r24,lo8(-2)
 376 00b6 01F4      		brne .L43
 158:tmk_core/common/mousekey.c ****         mousekey_accel |= (1 << 1);
 377               		.loc 1 158 0
 378 00b8 8091 0000 		lds r24,mousekey_accel
 379               	.LVL48:
 380 00bc 8260      		ori r24,lo8(2)
 381 00be 00C0      		rjmp .L45
 382               	.LVL49:
 383               	.L43:
 159:tmk_core/common/mousekey.c ****     else if (code == KC_MS_ACCEL2)
 384               		.loc 1 159 0
 385 00c0 8F3F      		cpi r24,lo8(-1)
 386 00c2 01F4      		brne .L27
 160:tmk_core/common/mousekey.c ****         mousekey_accel |= (1 << 2);
 387               		.loc 1 160 0
 388 00c4 8091 0000 		lds r24,mousekey_accel
 389               	.LVL50:
 390 00c8 8460      		ori r24,lo8(4)
 391               	.L45:
 392 00ca 8093 0000 		sts mousekey_accel,r24
 393               	.L27:
 394 00ce 0895      		ret
 395               		.cfi_endproc
 396               	.LFE7:
 398               		.section	.text.mousekey_off,"ax",@progbits
 399               	.global	mousekey_off
 401               	mousekey_off:
 402               	.LFB8:
 161:tmk_core/common/mousekey.c **** }
 162:tmk_core/common/mousekey.c **** 
 163:tmk_core/common/mousekey.c **** void mousekey_off(uint8_t code) {
 403               		.loc 1 163 0
 404               		.cfi_startproc
 405               	.LVL51:
 406               	/* prologue: function */
 407               	/* frame size = 0 */
 408               	/* stack size = 0 */
 409               	.L__stack_usage = 0
 164:tmk_core/common/mousekey.c ****     if (code == KC_MS_UP && mouse_report.y < 0)
 410               		.loc 1 164 0
 411 0000 803F      		cpi r24,lo8(-16)
 412 0002 01F4      		brne .L51
 413               		.loc 1 164 0 is_stmt 0 discriminator 1
 414 0004 8091 0000 		lds r24,mouse_report+3
 415               	.LVL52:
 416 0008 87FF      		sbrs r24,7
 417 000a 00C0      		rjmp .L52
 418               	.L54:
 165:tmk_core/common/mousekey.c ****         mouse_report.y = 0;
 419               		.loc 1 165 0 is_stmt 1
 420 000c 1092 0000 		sts mouse_report+3,__zero_reg__
 421 0010 00C0      		rjmp .L52
 422               	.LVL53:
 423               	.L51:
 166:tmk_core/common/mousekey.c ****     else if (code == KC_MS_DOWN && mouse_report.y > 0)
 424               		.loc 1 166 0
 425 0012 813F      		cpi r24,lo8(-15)
 426 0014 01F4      		brne .L53
 427               		.loc 1 166 0 is_stmt 0 discriminator 1
 428 0016 8091 0000 		lds r24,mouse_report+3
 429               	.LVL54:
 430 001a 1816      		cp __zero_reg__,r24
 431 001c 04F0      		brlt .L54
 432 001e 00C0      		rjmp .L52
 433               	.LVL55:
 434               	.L53:
 435 0020 9091 0000 		lds r25,mouse_report+2
 167:tmk_core/common/mousekey.c ****         mouse_report.y = 0;
 168:tmk_core/common/mousekey.c ****     else if (code == KC_MS_LEFT && mouse_report.x < 0)
 436               		.loc 1 168 0 is_stmt 1
 437 0024 823F      		cpi r24,lo8(-14)
 438 0026 01F4      		brne .L55
 439               		.loc 1 168 0 is_stmt 0 discriminator 1
 440 0028 97FF      		sbrs r25,7
 441 002a 00C0      		rjmp .L52
 442               	.L57:
 169:tmk_core/common/mousekey.c ****         mouse_report.x = 0;
 443               		.loc 1 169 0 is_stmt 1
 444 002c 1092 0000 		sts mouse_report+2,__zero_reg__
 445 0030 00C0      		rjmp .L52
 446               	.L55:
 170:tmk_core/common/mousekey.c ****     else if (code == KC_MS_RIGHT && mouse_report.x > 0)
 447               		.loc 1 170 0
 448 0032 833F      		cpi r24,lo8(-13)
 449 0034 01F4      		brne .L56
 450               		.loc 1 170 0 is_stmt 0 discriminator 1
 451 0036 1916      		cp __zero_reg__,r25
 452 0038 04F0      		brlt .L57
 453 003a 00C0      		rjmp .L52
 454               	.L56:
 171:tmk_core/common/mousekey.c ****         mouse_report.x = 0;
 172:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_UP && mouse_report.v > 0)
 455               		.loc 1 172 0 is_stmt 1
 456 003c 893F      		cpi r24,lo8(-7)
 457 003e 01F4      		brne .L58
 458               		.loc 1 172 0 is_stmt 0 discriminator 1
 459 0040 8091 0000 		lds r24,mouse_report+4
 460               	.LVL56:
 461 0044 1816      		cp __zero_reg__,r24
 462 0046 04F0      		brlt .+2
 463 0048 00C0      		rjmp .L52
 464               	.L60:
 173:tmk_core/common/mousekey.c ****         mouse_report.v = 0;
 465               		.loc 1 173 0 is_stmt 1
 466 004a 1092 0000 		sts mouse_report+4,__zero_reg__
 467 004e 00C0      		rjmp .L52
 468               	.LVL57:
 469               	.L58:
 174:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_DOWN && mouse_report.v < 0)
 470               		.loc 1 174 0
 471 0050 8A3F      		cpi r24,lo8(-6)
 472 0052 01F4      		brne .L59
 473               		.loc 1 174 0 is_stmt 0 discriminator 1
 474 0054 8091 0000 		lds r24,mouse_report+4
 475               	.LVL58:
 476 0058 87FF      		sbrs r24,7
 477 005a 00C0      		rjmp .L52
 478 005c 00C0      		rjmp .L60
 479               	.LVL59:
 480               	.L59:
 175:tmk_core/common/mousekey.c ****         mouse_report.v = 0;
 176:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_LEFT && mouse_report.h < 0)
 481               		.loc 1 176 0 is_stmt 1
 482 005e 8B3F      		cpi r24,lo8(-5)
 483 0060 01F4      		brne .L61
 484               		.loc 1 176 0 is_stmt 0 discriminator 1
 485 0062 8091 0000 		lds r24,mouse_report+5
 486               	.LVL60:
 487 0066 87FF      		sbrs r24,7
 488 0068 00C0      		rjmp .L52
 489               	.L63:
 177:tmk_core/common/mousekey.c ****         mouse_report.h = 0;
 490               		.loc 1 177 0 is_stmt 1
 491 006a 1092 0000 		sts mouse_report+5,__zero_reg__
 492 006e 00C0      		rjmp .L52
 493               	.LVL61:
 494               	.L61:
 178:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_RIGHT && mouse_report.h > 0)
 495               		.loc 1 178 0
 496 0070 8C3F      		cpi r24,lo8(-4)
 497 0072 01F4      		brne .L62
 498               		.loc 1 178 0 is_stmt 0 discriminator 1
 499 0074 8091 0000 		lds r24,mouse_report+5
 500               	.LVL62:
 501 0078 1816      		cp __zero_reg__,r24
 502 007a 04F0      		brlt .L63
 503 007c 00C0      		rjmp .L52
 504               	.LVL63:
 505               	.L62:
 179:tmk_core/common/mousekey.c ****         mouse_report.h = 0;
 180:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN1)
 506               		.loc 1 180 0 is_stmt 1
 507 007e 843F      		cpi r24,lo8(-12)
 508 0080 01F4      		brne .L64
 181:tmk_core/common/mousekey.c ****         mouse_report.buttons &= ~MOUSE_BTN1;
 509               		.loc 1 181 0
 510 0082 8091 0000 		lds r24,mouse_report+1
 511               	.LVL64:
 512 0086 8E7F      		andi r24,lo8(-2)
 513 0088 00C0      		rjmp .L73
 514               	.LVL65:
 515               	.L64:
 182:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN2)
 516               		.loc 1 182 0
 517 008a 853F      		cpi r24,lo8(-11)
 518 008c 01F4      		brne .L65
 183:tmk_core/common/mousekey.c ****         mouse_report.buttons &= ~MOUSE_BTN2;
 519               		.loc 1 183 0
 520 008e 8091 0000 		lds r24,mouse_report+1
 521               	.LVL66:
 522 0092 8D7F      		andi r24,lo8(-3)
 523 0094 00C0      		rjmp .L73
 524               	.LVL67:
 525               	.L65:
 184:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN3)
 526               		.loc 1 184 0
 527 0096 863F      		cpi r24,lo8(-10)
 528 0098 01F4      		brne .L66
 185:tmk_core/common/mousekey.c ****         mouse_report.buttons &= ~MOUSE_BTN3;
 529               		.loc 1 185 0
 530 009a 8091 0000 		lds r24,mouse_report+1
 531               	.LVL68:
 532 009e 8B7F      		andi r24,lo8(-5)
 533 00a0 00C0      		rjmp .L73
 534               	.LVL69:
 535               	.L66:
 186:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN4)
 536               		.loc 1 186 0
 537 00a2 873F      		cpi r24,lo8(-9)
 538 00a4 01F4      		brne .L67
 187:tmk_core/common/mousekey.c ****         mouse_report.buttons &= ~MOUSE_BTN4;
 539               		.loc 1 187 0
 540 00a6 8091 0000 		lds r24,mouse_report+1
 541               	.LVL70:
 542 00aa 877F      		andi r24,lo8(-9)
 543 00ac 00C0      		rjmp .L73
 544               	.LVL71:
 545               	.L67:
 188:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN5)
 546               		.loc 1 188 0
 547 00ae 883F      		cpi r24,lo8(-8)
 548 00b0 01F4      		brne .L68
 189:tmk_core/common/mousekey.c ****         mouse_report.buttons &= ~MOUSE_BTN5;
 549               		.loc 1 189 0
 550 00b2 8091 0000 		lds r24,mouse_report+1
 551               	.LVL72:
 552 00b6 8F7E      		andi r24,lo8(-17)
 553               	.L73:
 554 00b8 8093 0000 		sts mouse_report+1,r24
 555 00bc 00C0      		rjmp .L52
 556               	.LVL73:
 557               	.L68:
 190:tmk_core/common/mousekey.c ****     else if (code == KC_MS_ACCEL0)
 558               		.loc 1 190 0
 559 00be 8D3F      		cpi r24,lo8(-3)
 560 00c0 01F4      		brne .L69
 191:tmk_core/common/mousekey.c ****         mousekey_accel &= ~(1 << 0);
 561               		.loc 1 191 0
 562 00c2 8091 0000 		lds r24,mousekey_accel
 563               	.LVL74:
 564 00c6 8E7F      		andi r24,lo8(-2)
 565 00c8 00C0      		rjmp .L72
 566               	.LVL75:
 567               	.L69:
 192:tmk_core/common/mousekey.c ****     else if (code == KC_MS_ACCEL1)
 568               		.loc 1 192 0
 569 00ca 8E3F      		cpi r24,lo8(-2)
 570 00cc 01F4      		brne .L70
 193:tmk_core/common/mousekey.c ****         mousekey_accel &= ~(1 << 1);
 571               		.loc 1 193 0
 572 00ce 8091 0000 		lds r24,mousekey_accel
 573               	.LVL76:
 574 00d2 8D7F      		andi r24,lo8(-3)
 575 00d4 00C0      		rjmp .L72
 576               	.LVL77:
 577               	.L70:
 194:tmk_core/common/mousekey.c ****     else if (code == KC_MS_ACCEL2)
 578               		.loc 1 194 0
 579 00d6 8F3F      		cpi r24,lo8(-1)
 580 00d8 01F4      		brne .L52
 195:tmk_core/common/mousekey.c ****         mousekey_accel &= ~(1 << 2);
 581               		.loc 1 195 0
 582 00da 8091 0000 		lds r24,mousekey_accel
 583               	.LVL78:
 584 00de 8B7F      		andi r24,lo8(-5)
 585               	.L72:
 586 00e0 8093 0000 		sts mousekey_accel,r24
 587               	.L52:
 196:tmk_core/common/mousekey.c ****     if (mouse_report.x == 0 && mouse_report.y == 0 && mouse_report.v == 0 && mouse_report.h == 0) m
 588               		.loc 1 196 0
 589 00e4 8091 0000 		lds r24,mouse_report+2
 590 00e8 8111      		cpse r24,__zero_reg__
 591 00ea 00C0      		rjmp .L50
 592               		.loc 1 196 0 is_stmt 0 discriminator 1
 593 00ec 8091 0000 		lds r24,mouse_report+3
 594 00f0 8111      		cpse r24,__zero_reg__
 595 00f2 00C0      		rjmp .L50
 596               		.loc 1 196 0 discriminator 2
 597 00f4 8091 0000 		lds r24,mouse_report+4
 598 00f8 8111      		cpse r24,__zero_reg__
 599 00fa 00C0      		rjmp .L50
 600               		.loc 1 196 0 discriminator 3
 601 00fc 8091 0000 		lds r24,mouse_report+5
 602 0100 8111      		cpse r24,__zero_reg__
 603 0102 00C0      		rjmp .L50
 604               		.loc 1 196 0 discriminator 4
 605 0104 1092 0000 		sts mousekey_repeat,__zero_reg__
 606               	.L50:
 607 0108 0895      		ret
 608               		.cfi_endproc
 609               	.LFE8:
 611               		.section	.text.mousekey_send,"ax",@progbits
 612               	.global	mousekey_send
 614               	mousekey_send:
 615               	.LFB9:
 197:tmk_core/common/mousekey.c **** }
 198:tmk_core/common/mousekey.c **** 
 199:tmk_core/common/mousekey.c **** #else /* #ifndef MK_3_SPEED */
 200:tmk_core/common/mousekey.c **** 
 201:tmk_core/common/mousekey.c **** enum { mkspd_unmod, mkspd_0, mkspd_1, mkspd_2, mkspd_COUNT };
 202:tmk_core/common/mousekey.c **** #    ifndef MK_MOMENTARY_ACCEL
 203:tmk_core/common/mousekey.c **** static uint8_t  mk_speed                 = mkspd_1;
 204:tmk_core/common/mousekey.c **** #    else
 205:tmk_core/common/mousekey.c **** static uint8_t mk_speed      = mkspd_unmod;
 206:tmk_core/common/mousekey.c **** static uint8_t mkspd_DEFAULT = mkspd_unmod;
 207:tmk_core/common/mousekey.c **** #    endif
 208:tmk_core/common/mousekey.c **** static uint16_t last_timer_c             = 0;
 209:tmk_core/common/mousekey.c **** static uint16_t last_timer_w             = 0;
 210:tmk_core/common/mousekey.c **** uint16_t        c_offsets[mkspd_COUNT]   = {MK_C_OFFSET_UNMOD, MK_C_OFFSET_0, MK_C_OFFSET_1, MK_C_O
 211:tmk_core/common/mousekey.c **** uint16_t        c_intervals[mkspd_COUNT] = {MK_C_INTERVAL_UNMOD, MK_C_INTERVAL_0, MK_C_INTERVAL_1, 
 212:tmk_core/common/mousekey.c **** uint16_t        w_offsets[mkspd_COUNT]   = {MK_W_OFFSET_UNMOD, MK_W_OFFSET_0, MK_W_OFFSET_1, MK_W_O
 213:tmk_core/common/mousekey.c **** uint16_t        w_intervals[mkspd_COUNT] = {MK_W_INTERVAL_UNMOD, MK_W_INTERVAL_0, MK_W_INTERVAL_1, 
 214:tmk_core/common/mousekey.c **** 
 215:tmk_core/common/mousekey.c **** void mousekey_task(void) {
 216:tmk_core/common/mousekey.c ****     // report cursor and scroll movement independently
 217:tmk_core/common/mousekey.c ****     report_mouse_t const tmpmr = mouse_report;
 218:tmk_core/common/mousekey.c ****     if ((mouse_report.x || mouse_report.y) && timer_elapsed(last_timer_c) > c_intervals[mk_speed]) 
 219:tmk_core/common/mousekey.c ****         mouse_report.h = 0;
 220:tmk_core/common/mousekey.c ****         mouse_report.v = 0;
 221:tmk_core/common/mousekey.c ****         mousekey_send();
 222:tmk_core/common/mousekey.c ****         last_timer_c = last_timer;
 223:tmk_core/common/mousekey.c ****         mouse_report = tmpmr;
 224:tmk_core/common/mousekey.c ****     }
 225:tmk_core/common/mousekey.c ****     if ((mouse_report.h || mouse_report.v) && timer_elapsed(last_timer_w) > w_intervals[mk_speed]) 
 226:tmk_core/common/mousekey.c ****         mouse_report.x = 0;
 227:tmk_core/common/mousekey.c ****         mouse_report.y = 0;
 228:tmk_core/common/mousekey.c ****         mousekey_send();
 229:tmk_core/common/mousekey.c ****         last_timer_w = last_timer;
 230:tmk_core/common/mousekey.c ****         mouse_report = tmpmr;
 231:tmk_core/common/mousekey.c ****     }
 232:tmk_core/common/mousekey.c **** }
 233:tmk_core/common/mousekey.c **** 
 234:tmk_core/common/mousekey.c **** void adjust_speed(void) {
 235:tmk_core/common/mousekey.c ****     uint16_t const c_offset = c_offsets[mk_speed];
 236:tmk_core/common/mousekey.c ****     uint16_t const w_offset = w_offsets[mk_speed];
 237:tmk_core/common/mousekey.c ****     if (mouse_report.x > 0) mouse_report.x = c_offset;
 238:tmk_core/common/mousekey.c ****     if (mouse_report.x < 0) mouse_report.x = c_offset * -1;
 239:tmk_core/common/mousekey.c ****     if (mouse_report.y > 0) mouse_report.y = c_offset;
 240:tmk_core/common/mousekey.c ****     if (mouse_report.y < 0) mouse_report.y = c_offset * -1;
 241:tmk_core/common/mousekey.c ****     if (mouse_report.h > 0) mouse_report.h = w_offset;
 242:tmk_core/common/mousekey.c ****     if (mouse_report.h < 0) mouse_report.h = w_offset * -1;
 243:tmk_core/common/mousekey.c ****     if (mouse_report.v > 0) mouse_report.v = w_offset;
 244:tmk_core/common/mousekey.c ****     if (mouse_report.v < 0) mouse_report.v = w_offset * -1;
 245:tmk_core/common/mousekey.c ****     // adjust for diagonals
 246:tmk_core/common/mousekey.c ****     if (mouse_report.x && mouse_report.y) {
 247:tmk_core/common/mousekey.c ****         mouse_report.x = times_inv_sqrt2(mouse_report.x);
 248:tmk_core/common/mousekey.c ****         if (mouse_report.x == 0) {
 249:tmk_core/common/mousekey.c ****             mouse_report.x = 1;
 250:tmk_core/common/mousekey.c ****         }
 251:tmk_core/common/mousekey.c ****         mouse_report.y = times_inv_sqrt2(mouse_report.y);
 252:tmk_core/common/mousekey.c ****         if (mouse_report.y == 0) {
 253:tmk_core/common/mousekey.c ****             mouse_report.y = 1;
 254:tmk_core/common/mousekey.c ****         }
 255:tmk_core/common/mousekey.c ****     }
 256:tmk_core/common/mousekey.c ****     if (mouse_report.h && mouse_report.v) {
 257:tmk_core/common/mousekey.c ****         mouse_report.h = times_inv_sqrt2(mouse_report.h);
 258:tmk_core/common/mousekey.c ****         mouse_report.v = times_inv_sqrt2(mouse_report.v);
 259:tmk_core/common/mousekey.c ****     }
 260:tmk_core/common/mousekey.c **** }
 261:tmk_core/common/mousekey.c **** 
 262:tmk_core/common/mousekey.c **** void mousekey_on(uint8_t code) {
 263:tmk_core/common/mousekey.c ****     uint16_t const c_offset  = c_offsets[mk_speed];
 264:tmk_core/common/mousekey.c ****     uint16_t const w_offset  = w_offsets[mk_speed];
 265:tmk_core/common/mousekey.c ****     uint8_t const  old_speed = mk_speed;
 266:tmk_core/common/mousekey.c ****     if (code == KC_MS_UP)
 267:tmk_core/common/mousekey.c ****         mouse_report.y = c_offset * -1;
 268:tmk_core/common/mousekey.c ****     else if (code == KC_MS_DOWN)
 269:tmk_core/common/mousekey.c ****         mouse_report.y = c_offset;
 270:tmk_core/common/mousekey.c ****     else if (code == KC_MS_LEFT)
 271:tmk_core/common/mousekey.c ****         mouse_report.x = c_offset * -1;
 272:tmk_core/common/mousekey.c ****     else if (code == KC_MS_RIGHT)
 273:tmk_core/common/mousekey.c ****         mouse_report.x = c_offset;
 274:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_UP)
 275:tmk_core/common/mousekey.c ****         mouse_report.v = w_offset;
 276:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_DOWN)
 277:tmk_core/common/mousekey.c ****         mouse_report.v = w_offset * -1;
 278:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_LEFT)
 279:tmk_core/common/mousekey.c ****         mouse_report.h = w_offset * -1;
 280:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_RIGHT)
 281:tmk_core/common/mousekey.c ****         mouse_report.h = w_offset;
 282:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN1)
 283:tmk_core/common/mousekey.c ****         mouse_report.buttons |= MOUSE_BTN1;
 284:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN2)
 285:tmk_core/common/mousekey.c ****         mouse_report.buttons |= MOUSE_BTN2;
 286:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN3)
 287:tmk_core/common/mousekey.c ****         mouse_report.buttons |= MOUSE_BTN3;
 288:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN4)
 289:tmk_core/common/mousekey.c ****         mouse_report.buttons |= MOUSE_BTN4;
 290:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN5)
 291:tmk_core/common/mousekey.c ****         mouse_report.buttons |= MOUSE_BTN5;
 292:tmk_core/common/mousekey.c ****     else if (code == KC_MS_ACCEL0)
 293:tmk_core/common/mousekey.c ****         mk_speed = mkspd_0;
 294:tmk_core/common/mousekey.c ****     else if (code == KC_MS_ACCEL1)
 295:tmk_core/common/mousekey.c ****         mk_speed = mkspd_1;
 296:tmk_core/common/mousekey.c ****     else if (code == KC_MS_ACCEL2)
 297:tmk_core/common/mousekey.c ****         mk_speed = mkspd_2;
 298:tmk_core/common/mousekey.c ****     if (mk_speed != old_speed) adjust_speed();
 299:tmk_core/common/mousekey.c **** }
 300:tmk_core/common/mousekey.c **** 
 301:tmk_core/common/mousekey.c **** void mousekey_off(uint8_t code) {
 302:tmk_core/common/mousekey.c **** #    ifdef MK_MOMENTARY_ACCEL
 303:tmk_core/common/mousekey.c ****     uint8_t const old_speed = mk_speed;
 304:tmk_core/common/mousekey.c **** #    endif
 305:tmk_core/common/mousekey.c ****     if (code == KC_MS_UP && mouse_report.y < 0)
 306:tmk_core/common/mousekey.c ****         mouse_report.y = 0;
 307:tmk_core/common/mousekey.c ****     else if (code == KC_MS_DOWN && mouse_report.y > 0)
 308:tmk_core/common/mousekey.c ****         mouse_report.y = 0;
 309:tmk_core/common/mousekey.c ****     else if (code == KC_MS_LEFT && mouse_report.x < 0)
 310:tmk_core/common/mousekey.c ****         mouse_report.x = 0;
 311:tmk_core/common/mousekey.c ****     else if (code == KC_MS_RIGHT && mouse_report.x > 0)
 312:tmk_core/common/mousekey.c ****         mouse_report.x = 0;
 313:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_UP && mouse_report.v > 0)
 314:tmk_core/common/mousekey.c ****         mouse_report.v = 0;
 315:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_DOWN && mouse_report.v < 0)
 316:tmk_core/common/mousekey.c ****         mouse_report.v = 0;
 317:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_LEFT && mouse_report.h < 0)
 318:tmk_core/common/mousekey.c ****         mouse_report.h = 0;
 319:tmk_core/common/mousekey.c ****     else if (code == KC_MS_WH_RIGHT && mouse_report.h > 0)
 320:tmk_core/common/mousekey.c ****         mouse_report.h = 0;
 321:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN1)
 322:tmk_core/common/mousekey.c ****         mouse_report.buttons &= ~MOUSE_BTN1;
 323:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN2)
 324:tmk_core/common/mousekey.c ****         mouse_report.buttons &= ~MOUSE_BTN2;
 325:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN3)
 326:tmk_core/common/mousekey.c ****         mouse_report.buttons &= ~MOUSE_BTN3;
 327:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN4)
 328:tmk_core/common/mousekey.c ****         mouse_report.buttons &= ~MOUSE_BTN4;
 329:tmk_core/common/mousekey.c ****     else if (code == KC_MS_BTN5)
 330:tmk_core/common/mousekey.c ****         mouse_report.buttons &= ~MOUSE_BTN5;
 331:tmk_core/common/mousekey.c **** #    ifdef MK_MOMENTARY_ACCEL
 332:tmk_core/common/mousekey.c ****     else if (code == KC_MS_ACCEL0)
 333:tmk_core/common/mousekey.c ****         mk_speed = mkspd_DEFAULT;
 334:tmk_core/common/mousekey.c ****     else if (code == KC_MS_ACCEL1)
 335:tmk_core/common/mousekey.c ****         mk_speed = mkspd_DEFAULT;
 336:tmk_core/common/mousekey.c ****     else if (code == KC_MS_ACCEL2)
 337:tmk_core/common/mousekey.c ****         mk_speed = mkspd_DEFAULT;
 338:tmk_core/common/mousekey.c ****     if (mk_speed != old_speed) adjust_speed();
 339:tmk_core/common/mousekey.c **** #    endif
 340:tmk_core/common/mousekey.c **** }
 341:tmk_core/common/mousekey.c **** 
 342:tmk_core/common/mousekey.c **** #endif /* #ifndef MK_3_SPEED */
 343:tmk_core/common/mousekey.c **** 
 344:tmk_core/common/mousekey.c **** void mousekey_send(void) {
 616               		.loc 1 344 0 is_stmt 1
 617               		.cfi_startproc
 618               	/* prologue: function */
 619               	/* frame size = 0 */
 620               	/* stack size = 0 */
 621               	.L__stack_usage = 0
 622               	.LBB23:
 623               	.LBB24:
 345:tmk_core/common/mousekey.c ****     mousekey_debug();
 346:tmk_core/common/mousekey.c ****     host_mouse_send(&mouse_report);
 347:tmk_core/common/mousekey.c ****     last_timer = timer_read();
 348:tmk_core/common/mousekey.c **** }
 349:tmk_core/common/mousekey.c **** 
 350:tmk_core/common/mousekey.c **** void mousekey_clear(void) {
 351:tmk_core/common/mousekey.c ****     mouse_report    = (report_mouse_t){};
 352:tmk_core/common/mousekey.c ****     mousekey_repeat = 0;
 353:tmk_core/common/mousekey.c ****     mousekey_accel  = 0;
 354:tmk_core/common/mousekey.c **** }
 355:tmk_core/common/mousekey.c **** 
 356:tmk_core/common/mousekey.c **** static void mousekey_debug(void) {
 357:tmk_core/common/mousekey.c ****     if (!debug_mouse) return;
 624               		.loc 1 357 0
 625 0000 8091 0000 		lds r24,debug_config
 626 0004 83FF      		sbrs r24,3
 627 0006 00C0      		rjmp .L75
 358:tmk_core/common/mousekey.c ****     print("mousekey [btn|x y v h](rep/acl): [");
 628               		.loc 1 358 0
 629 0008 80E0      		ldi r24,lo8(__c.2221)
 630 000a 90E0      		ldi r25,hi8(__c.2221)
 631 000c 0E94 0000 		call xputs
 359:tmk_core/common/mousekey.c ****     phex(mouse_report.buttons);
 632               		.loc 1 359 0
 633 0010 8091 0000 		lds r24,mouse_report+1
 634 0014 1F92      		push __zero_reg__
 635               	.LCFI0:
 636               		.cfi_def_cfa_offset 3
 637 0016 8F93      		push r24
 638               	.LCFI1:
 639               		.cfi_def_cfa_offset 4
 640 0018 80E0      		ldi r24,lo8(__c.2223)
 641 001a 90E0      		ldi r25,hi8(__c.2223)
 642 001c 9F93      		push r25
 643               	.LCFI2:
 644               		.cfi_def_cfa_offset 5
 645 001e 8F93      		push r24
 646               	.LCFI3:
 647               		.cfi_def_cfa_offset 6
 648 0020 0E94 0000 		call __xprintf
 360:tmk_core/common/mousekey.c ****     print("|");
 649               		.loc 1 360 0
 650 0024 80E0      		ldi r24,lo8(__c.2225)
 651 0026 90E0      		ldi r25,hi8(__c.2225)
 652 0028 0E94 0000 		call xputs
 361:tmk_core/common/mousekey.c ****     print_decs(mouse_report.x);
 653               		.loc 1 361 0
 654 002c 8091 0000 		lds r24,mouse_report+2
 655 0030 282F      		mov r18,r24
 656 0032 082E      		mov __tmp_reg__,r24
 657 0034 000C      		lsl r0
 658 0036 330B      		sbc r19,r19
 659 0038 3F93      		push r19
 660               	.LCFI4:
 661               		.cfi_def_cfa_offset 7
 662 003a 8F93      		push r24
 663               	.LCFI5:
 664               		.cfi_def_cfa_offset 8
 665 003c 80E0      		ldi r24,lo8(__c.2227)
 666 003e 90E0      		ldi r25,hi8(__c.2227)
 667 0040 9F93      		push r25
 668               	.LCFI6:
 669               		.cfi_def_cfa_offset 9
 670 0042 8F93      		push r24
 671               	.LCFI7:
 672               		.cfi_def_cfa_offset 10
 673 0044 0E94 0000 		call __xprintf
 362:tmk_core/common/mousekey.c ****     print(" ");
 674               		.loc 1 362 0
 675 0048 80E0      		ldi r24,lo8(__c.2229)
 676 004a 90E0      		ldi r25,hi8(__c.2229)
 677 004c 0E94 0000 		call xputs
 363:tmk_core/common/mousekey.c ****     print_decs(mouse_report.y);
 678               		.loc 1 363 0
 679 0050 8091 0000 		lds r24,mouse_report+3
 680 0054 282F      		mov r18,r24
 681 0056 082E      		mov __tmp_reg__,r24
 682 0058 000C      		lsl r0
 683 005a 330B      		sbc r19,r19
 684 005c 3F93      		push r19
 685               	.LCFI8:
 686               		.cfi_def_cfa_offset 11
 687 005e 8F93      		push r24
 688               	.LCFI9:
 689               		.cfi_def_cfa_offset 12
 690 0060 80E0      		ldi r24,lo8(__c.2231)
 691 0062 90E0      		ldi r25,hi8(__c.2231)
 692 0064 9F93      		push r25
 693               	.LCFI10:
 694               		.cfi_def_cfa_offset 13
 695 0066 8F93      		push r24
 696               	.LCFI11:
 697               		.cfi_def_cfa_offset 14
 698 0068 0E94 0000 		call __xprintf
 364:tmk_core/common/mousekey.c ****     print(" ");
 699               		.loc 1 364 0
 700 006c 80E0      		ldi r24,lo8(__c.2233)
 701 006e 90E0      		ldi r25,hi8(__c.2233)
 702 0070 0E94 0000 		call xputs
 365:tmk_core/common/mousekey.c ****     print_decs(mouse_report.v);
 703               		.loc 1 365 0
 704 0074 8091 0000 		lds r24,mouse_report+4
 705 0078 282F      		mov r18,r24
 706 007a 082E      		mov __tmp_reg__,r24
 707 007c 000C      		lsl r0
 708 007e 330B      		sbc r19,r19
 709 0080 3F93      		push r19
 710               	.LCFI12:
 711               		.cfi_def_cfa_offset 15
 712 0082 8F93      		push r24
 713               	.LCFI13:
 714               		.cfi_def_cfa_offset 16
 715 0084 80E0      		ldi r24,lo8(__c.2235)
 716 0086 90E0      		ldi r25,hi8(__c.2235)
 717 0088 9F93      		push r25
 718               	.LCFI14:
 719               		.cfi_def_cfa_offset 17
 720 008a 8F93      		push r24
 721               	.LCFI15:
 722               		.cfi_def_cfa_offset 18
 723 008c 0E94 0000 		call __xprintf
 366:tmk_core/common/mousekey.c ****     print(" ");
 724               		.loc 1 366 0
 725 0090 80E0      		ldi r24,lo8(__c.2237)
 726 0092 90E0      		ldi r25,hi8(__c.2237)
 727 0094 0E94 0000 		call xputs
 367:tmk_core/common/mousekey.c ****     print_decs(mouse_report.h);
 728               		.loc 1 367 0
 729 0098 8091 0000 		lds r24,mouse_report+5
 730 009c 282F      		mov r18,r24
 731 009e 082E      		mov __tmp_reg__,r24
 732 00a0 000C      		lsl r0
 733 00a2 330B      		sbc r19,r19
 734 00a4 3F93      		push r19
 735               	.LCFI16:
 736               		.cfi_def_cfa_offset 19
 737 00a6 8F93      		push r24
 738               	.LCFI17:
 739               		.cfi_def_cfa_offset 20
 740 00a8 80E0      		ldi r24,lo8(__c.2239)
 741 00aa 90E0      		ldi r25,hi8(__c.2239)
 742 00ac 9F93      		push r25
 743               	.LCFI18:
 744               		.cfi_def_cfa_offset 21
 745 00ae 8F93      		push r24
 746               	.LCFI19:
 747               		.cfi_def_cfa_offset 22
 748 00b0 0E94 0000 		call __xprintf
 368:tmk_core/common/mousekey.c ****     print("](");
 749               		.loc 1 368 0
 750 00b4 80E0      		ldi r24,lo8(__c.2241)
 751 00b6 90E0      		ldi r25,hi8(__c.2241)
 752 00b8 0E94 0000 		call xputs
 369:tmk_core/common/mousekey.c ****     print_dec(mousekey_repeat);
 753               		.loc 1 369 0
 754 00bc 8091 0000 		lds r24,mousekey_repeat
 755 00c0 1F92      		push __zero_reg__
 756               	.LCFI20:
 757               		.cfi_def_cfa_offset 23
 758 00c2 8F93      		push r24
 759               	.LCFI21:
 760               		.cfi_def_cfa_offset 24
 761 00c4 80E0      		ldi r24,lo8(__c.2243)
 762 00c6 90E0      		ldi r25,hi8(__c.2243)
 763 00c8 9F93      		push r25
 764               	.LCFI22:
 765               		.cfi_def_cfa_offset 25
 766 00ca 8F93      		push r24
 767               	.LCFI23:
 768               		.cfi_def_cfa_offset 26
 769 00cc 0E94 0000 		call __xprintf
 370:tmk_core/common/mousekey.c ****     print("/");
 770               		.loc 1 370 0
 771 00d0 80E0      		ldi r24,lo8(__c.2245)
 772 00d2 90E0      		ldi r25,hi8(__c.2245)
 773 00d4 0E94 0000 		call xputs
 371:tmk_core/common/mousekey.c ****     print_dec(mousekey_accel);
 774               		.loc 1 371 0
 775 00d8 8091 0000 		lds r24,mousekey_accel
 776 00dc 1F92      		push __zero_reg__
 777               	.LCFI24:
 778               		.cfi_def_cfa_offset 27
 779 00de 8F93      		push r24
 780               	.LCFI25:
 781               		.cfi_def_cfa_offset 28
 782 00e0 80E0      		ldi r24,lo8(__c.2247)
 783 00e2 90E0      		ldi r25,hi8(__c.2247)
 784 00e4 9F93      		push r25
 785               	.LCFI26:
 786               		.cfi_def_cfa_offset 29
 787 00e6 8F93      		push r24
 788               	.LCFI27:
 789               		.cfi_def_cfa_offset 30
 790 00e8 0E94 0000 		call __xprintf
 372:tmk_core/common/mousekey.c ****     print(")\n");
 791               		.loc 1 372 0
 792 00ec 80E0      		ldi r24,lo8(__c.2249)
 793 00ee 90E0      		ldi r25,hi8(__c.2249)
 794 00f0 0E94 0000 		call xputs
 795 00f4 8DB7      		in r24,__SP_L__
 796 00f6 9EB7      		in r25,__SP_H__
 797 00f8 4C96      		adiw r24,28
 798 00fa 0FB6      		in __tmp_reg__,__SREG__
 799 00fc F894      		cli
 800 00fe 9EBF      		out __SP_H__,r25
 801 0100 0FBE      		out __SREG__,__tmp_reg__
 802 0102 8DBF      		out __SP_L__,r24
 803               	.LCFI28:
 804               		.cfi_def_cfa_offset 2
 805               	.L75:
 806               	.LBE24:
 807               	.LBE23:
 346:tmk_core/common/mousekey.c ****     last_timer = timer_read();
 808               		.loc 1 346 0
 809 0104 80E0      		ldi r24,lo8(mouse_report)
 810 0106 90E0      		ldi r25,hi8(mouse_report)
 811 0108 0E94 0000 		call host_mouse_send
 347:tmk_core/common/mousekey.c **** }
 812               		.loc 1 347 0
 813 010c 0E94 0000 		call timer_read
 814 0110 9093 0000 		sts last_timer+1,r25
 815 0114 8093 0000 		sts last_timer,r24
 816 0118 0895      		ret
 817               		.cfi_endproc
 818               	.LFE9:
 820               		.section	.text.mousekey_task,"ax",@progbits
 821               	.global	mousekey_task
 823               	mousekey_task:
 824               	.LFB6:
  98:tmk_core/common/mousekey.c ****     if (timer_elapsed(last_timer) < (mousekey_repeat ? mk_interval : mk_delay * 10)) {
 825               		.loc 1 98 0
 826               		.cfi_startproc
 827 0000 1F93      		push r17
 828               	.LCFI29:
 829               		.cfi_def_cfa_offset 3
 830               		.cfi_offset 17, -2
 831 0002 CF93      		push r28
 832               	.LCFI30:
 833               		.cfi_def_cfa_offset 4
 834               		.cfi_offset 28, -3
 835 0004 DF93      		push r29
 836               	.LCFI31:
 837               		.cfi_def_cfa_offset 5
 838               		.cfi_offset 29, -4
 839               	/* prologue: function */
 840               	/* frame size = 0 */
 841               	/* stack size = 3 */
 842               	.L__stack_usage = 3
  99:tmk_core/common/mousekey.c ****         return;
 843               		.loc 1 99 0
 844 0006 8091 0000 		lds r24,last_timer
 845 000a 9091 0000 		lds r25,last_timer+1
 846 000e 0E94 0000 		call timer_elapsed
 847               	.LVL79:
 848 0012 FC01      		movw r30,r24
 849 0014 2091 0000 		lds r18,mousekey_repeat
 850 0018 2223      		tst r18
 851 001a 01F0      		breq .L80
  99:tmk_core/common/mousekey.c ****         return;
 852               		.loc 1 99 0 is_stmt 0 discriminator 1
 853 001c 8091 0000 		lds r24,mk_interval
 854 0020 90E0      		ldi r25,0
 855 0022 00C0      		rjmp .L81
 856               	.L80:
  99:tmk_core/common/mousekey.c ****         return;
 857               		.loc 1 99 0 discriminator 2
 858 0024 8091 0000 		lds r24,mk_delay
 859 0028 90E0      		ldi r25,0
 860 002a 6AE0      		ldi r22,lo8(10)
 861 002c 70E0      		ldi r23,0
 862 002e 0E94 0000 		call __mulhi3
 863               	.L81:
  99:tmk_core/common/mousekey.c ****         return;
 864               		.loc 1 99 0 discriminator 4
 865 0032 E817      		cp r30,r24
 866 0034 F907      		cpc r31,r25
 867 0036 00F4      		brsh .+2
 868 0038 00C0      		rjmp .L79
 102:tmk_core/common/mousekey.c ****         return;
 869               		.loc 1 102 0 is_stmt 1
 870 003a 8091 0000 		lds r24,mouse_report+2
 871 003e C091 0000 		lds r28,mouse_report+3
 872 0042 D091 0000 		lds r29,mouse_report+4
 873 0046 1091 0000 		lds r17,mouse_report+5
 874 004a 8111      		cpse r24,__zero_reg__
 875 004c 00C0      		rjmp .L83
 102:tmk_core/common/mousekey.c ****         return;
 876               		.loc 1 102 0 is_stmt 0 discriminator 1
 877 004e C111      		cpse r28,__zero_reg__
 878 0050 00C0      		rjmp .L84
 102:tmk_core/common/mousekey.c ****         return;
 879               		.loc 1 102 0 discriminator 2
 880 0052 D111      		cpse r29,__zero_reg__
 881 0054 00C0      		rjmp .L84
 102:tmk_core/common/mousekey.c ****         return;
 882               		.loc 1 102 0 discriminator 3
 883 0056 1111      		cpse r17,__zero_reg__
 884 0058 00C0      		rjmp .L84
 885 005a 00C0      		rjmp .L79
 886               	.L83:
 105:tmk_core/common/mousekey.c ****     if (mouse_report.x > 0) mouse_report.x = move_unit();
 887               		.loc 1 105 0 is_stmt 1
 888 005c 2F3F      		cpi r18,lo8(-1)
 889 005e 01F0      		breq .L85
 890               	.L100:
 105:tmk_core/common/mousekey.c ****     if (mouse_report.x > 0) mouse_report.x = move_unit();
 891               		.loc 1 105 0 is_stmt 0 discriminator 1
 892 0060 2F5F      		subi r18,lo8(-(1))
 893 0062 2093 0000 		sts mousekey_repeat,r18
 894               	.L85:
 106:tmk_core/common/mousekey.c ****     if (mouse_report.x < 0) mouse_report.x = move_unit() * -1;
 895               		.loc 1 106 0 is_stmt 1
 896 0066 1816      		cp __zero_reg__,r24
 897 0068 04F4      		brge .L86
 106:tmk_core/common/mousekey.c ****     if (mouse_report.x < 0) mouse_report.x = move_unit() * -1;
 898               		.loc 1 106 0 is_stmt 0 discriminator 1
 899 006a 0E94 0000 		call move_unit
 900               	.LVL80:
 901 006e 8093 0000 		sts mouse_report+2,r24
 902               	.L86:
 107:tmk_core/common/mousekey.c ****     if (mouse_report.y > 0) mouse_report.y = move_unit();
 903               		.loc 1 107 0 is_stmt 1
 904 0072 8091 0000 		lds r24,mouse_report+2
 905 0076 87FF      		sbrs r24,7
 906 0078 00C0      		rjmp .L87
 107:tmk_core/common/mousekey.c ****     if (mouse_report.y > 0) mouse_report.y = move_unit();
 907               		.loc 1 107 0 is_stmt 0 discriminator 1
 908 007a 0E94 0000 		call move_unit
 909               	.LVL81:
 910 007e 8195      		neg r24
 911 0080 8093 0000 		sts mouse_report+2,r24
 912               	.L87:
 108:tmk_core/common/mousekey.c ****     if (mouse_report.y < 0) mouse_report.y = move_unit() * -1;
 913               		.loc 1 108 0 is_stmt 1
 914 0084 1C16      		cp __zero_reg__,r28
 915 0086 04F4      		brge .L88
 108:tmk_core/common/mousekey.c ****     if (mouse_report.y < 0) mouse_report.y = move_unit() * -1;
 916               		.loc 1 108 0 is_stmt 0 discriminator 1
 917 0088 0E94 0000 		call move_unit
 918               	.LVL82:
 919 008c 8093 0000 		sts mouse_report+3,r24
 920               	.L88:
 109:tmk_core/common/mousekey.c ****     /* diagonal move [1/sqrt(2)] */
 921               		.loc 1 109 0 is_stmt 1
 922 0090 8091 0000 		lds r24,mouse_report+3
 923 0094 87FF      		sbrs r24,7
 924 0096 00C0      		rjmp .L89
 109:tmk_core/common/mousekey.c ****     /* diagonal move [1/sqrt(2)] */
 925               		.loc 1 109 0 is_stmt 0 discriminator 1
 926 0098 0E94 0000 		call move_unit
 927               	.LVL83:
 928 009c 8195      		neg r24
 929 009e 8093 0000 		sts mouse_report+3,r24
 930               	.L89:
 111:tmk_core/common/mousekey.c ****         mouse_report.x = times_inv_sqrt2(mouse_report.x);
 931               		.loc 1 111 0 is_stmt 1
 932 00a2 8091 0000 		lds r24,mouse_report+2
 933 00a6 8823      		tst r24
 934 00a8 01F0      		breq .L91
 111:tmk_core/common/mousekey.c ****         mouse_report.x = times_inv_sqrt2(mouse_report.x);
 935               		.loc 1 111 0 is_stmt 0 discriminator 1
 936 00aa 2091 0000 		lds r18,mouse_report+3
 937 00ae 2223      		tst r18
 938 00b0 01F0      		breq .L91
 939               	.LVL84:
 940               	.LBB25:
 941               	.LBB26:
  31:tmk_core/common/mousekey.c **** }
 942               		.loc 1 31 0 is_stmt 1
 943 00b2 082E      		mov __tmp_reg__,r24
 944 00b4 000C      		lsl r0
 945 00b6 990B      		sbc r25,r25
 946               	.LVL85:
 947 00b8 65EB      		ldi r22,lo8(-75)
 948 00ba 70E0      		ldi r23,0
 949 00bc 0E94 0000 		call __mulhi3
 950               	.LVL86:
 951               	.LBE26:
 952               	.LBE25:
 113:tmk_core/common/mousekey.c ****             mouse_report.x = 1;
 953               		.loc 1 113 0
 954 00c0 9923      		tst r25
 955 00c2 01F0      		breq .L93
 112:tmk_core/common/mousekey.c ****         if (mouse_report.x == 0) {
 956               		.loc 1 112 0
 957 00c4 9093 0000 		sts mouse_report+2,r25
 958 00c8 00C0      		rjmp .L94
 959               	.L93:
 114:tmk_core/common/mousekey.c ****         }
 960               		.loc 1 114 0
 961 00ca 81E0      		ldi r24,lo8(1)
 962 00cc 8093 0000 		sts mouse_report+2,r24
 963               	.L94:
 964               	.LVL87:
 965               	.LBB27:
 966               	.LBB28:
  31:tmk_core/common/mousekey.c **** }
 967               		.loc 1 31 0
 968 00d0 822F      		mov r24,r18
 969 00d2 220F      		lsl r18
 970 00d4 990B      		sbc r25,r25
 971 00d6 65EB      		ldi r22,lo8(-75)
 972 00d8 70E0      		ldi r23,0
 973 00da 0E94 0000 		call __mulhi3
 974               	.LVL88:
 975               	.LBE28:
 976               	.LBE27:
 117:tmk_core/common/mousekey.c ****             mouse_report.y = 1;
 977               		.loc 1 117 0
 978 00de 9923      		tst r25
 979 00e0 01F0      		breq .L95
 116:tmk_core/common/mousekey.c ****         if (mouse_report.y == 0) {
 980               		.loc 1 116 0
 981 00e2 9093 0000 		sts mouse_report+3,r25
 982 00e6 00C0      		rjmp .L91
 983               	.L95:
 118:tmk_core/common/mousekey.c ****         }
 984               		.loc 1 118 0
 985 00e8 81E0      		ldi r24,lo8(1)
 986 00ea 8093 0000 		sts mouse_report+3,r24
 987               	.L91:
 121:tmk_core/common/mousekey.c ****     if (mouse_report.v < 0) mouse_report.v = wheel_unit() * -1;
 988               		.loc 1 121 0
 989 00ee 1D16      		cp __zero_reg__,r29
 990 00f0 04F4      		brge .L96
 121:tmk_core/common/mousekey.c ****     if (mouse_report.v < 0) mouse_report.v = wheel_unit() * -1;
 991               		.loc 1 121 0 is_stmt 0 discriminator 1
 992 00f2 0E94 0000 		call wheel_unit
 993               	.LVL89:
 994 00f6 8093 0000 		sts mouse_report+4,r24
 995               	.L96:
 122:tmk_core/common/mousekey.c ****     if (mouse_report.h > 0) mouse_report.h = wheel_unit();
 996               		.loc 1 122 0 is_stmt 1
 997 00fa 8091 0000 		lds r24,mouse_report+4
 998 00fe 87FF      		sbrs r24,7
 999 0100 00C0      		rjmp .L97
 122:tmk_core/common/mousekey.c ****     if (mouse_report.h > 0) mouse_report.h = wheel_unit();
 1000               		.loc 1 122 0 is_stmt 0 discriminator 1
 1001 0102 0E94 0000 		call wheel_unit
 1002               	.LVL90:
 1003 0106 8195      		neg r24
 1004 0108 8093 0000 		sts mouse_report+4,r24
 1005               	.L97:
 123:tmk_core/common/mousekey.c ****     if (mouse_report.h < 0) mouse_report.h = wheel_unit() * -1;
 1006               		.loc 1 123 0 is_stmt 1
 1007 010c 1116      		cp __zero_reg__,r17
 1008 010e 04F4      		brge .L98
 123:tmk_core/common/mousekey.c ****     if (mouse_report.h < 0) mouse_report.h = wheel_unit() * -1;
 1009               		.loc 1 123 0 is_stmt 0 discriminator 1
 1010 0110 0E94 0000 		call wheel_unit
 1011               	.LVL91:
 1012 0114 8093 0000 		sts mouse_report+5,r24
 1013               	.L98:
 124:tmk_core/common/mousekey.c ****     mousekey_send();
 1014               		.loc 1 124 0 is_stmt 1
 1015 0118 8091 0000 		lds r24,mouse_report+5
 1016 011c 87FF      		sbrs r24,7
 1017 011e 00C0      		rjmp .L99
 124:tmk_core/common/mousekey.c ****     mousekey_send();
 1018               		.loc 1 124 0 is_stmt 0 discriminator 1
 1019 0120 0E94 0000 		call wheel_unit
 1020               	.LVL92:
 1021 0124 8195      		neg r24
 1022 0126 8093 0000 		sts mouse_report+5,r24
 1023               	.L99:
 1024               	/* epilogue start */
 126:tmk_core/common/mousekey.c **** 
 1025               		.loc 1 126 0 is_stmt 1
 1026 012a DF91      		pop r29
 1027 012c CF91      		pop r28
 1028 012e 1F91      		pop r17
 125:tmk_core/common/mousekey.c **** }
 1029               		.loc 1 125 0
 1030 0130 0C94 0000 		jmp mousekey_send
 1031               	.LVL93:
 1032               	.L84:
 105:tmk_core/common/mousekey.c ****     if (mouse_report.x > 0) mouse_report.x = move_unit();
 1033               		.loc 1 105 0
 1034 0134 2F3F      		cpi r18,lo8(-1)
 1035 0136 01F0      		breq .+2
 1036 0138 00C0      		rjmp .L100
 1037 013a 00C0      		rjmp .L87
 1038               	.L79:
 1039               	/* epilogue start */
 126:tmk_core/common/mousekey.c **** 
 1040               		.loc 1 126 0
 1041 013c DF91      		pop r29
 1042 013e CF91      		pop r28
 1043 0140 1F91      		pop r17
 1044 0142 0895      		ret
 1045               		.cfi_endproc
 1046               	.LFE6:
 1048               		.section	.text.mousekey_clear,"ax",@progbits
 1049               	.global	mousekey_clear
 1051               	mousekey_clear:
 1052               	.LFB10:
 350:tmk_core/common/mousekey.c ****     mouse_report    = (report_mouse_t){};
 1053               		.loc 1 350 0
 1054               		.cfi_startproc
 1055               	/* prologue: function */
 1056               	/* frame size = 0 */
 1057               	/* stack size = 0 */
 1058               	.L__stack_usage = 0
 351:tmk_core/common/mousekey.c ****     mousekey_repeat = 0;
 1059               		.loc 1 351 0
 1060 0000 E0E0      		ldi r30,lo8(mouse_report)
 1061 0002 F0E0      		ldi r31,hi8(mouse_report)
 1062 0004 86E0      		ldi r24,lo8(6)
 1063 0006 DF01      		movw r26,r30
 1064               		0:
 1065 0008 1D92      		st X+,__zero_reg__
 1066 000a 8A95      		dec r24
 1067 000c 01F4      		brne 0b
 352:tmk_core/common/mousekey.c ****     mousekey_accel  = 0;
 1068               		.loc 1 352 0
 1069 000e 1092 0000 		sts mousekey_repeat,__zero_reg__
 353:tmk_core/common/mousekey.c **** }
 1070               		.loc 1 353 0
 1071 0012 1092 0000 		sts mousekey_accel,__zero_reg__
 1072 0016 0895      		ret
 1073               		.cfi_endproc
 1074               	.LFE10:
 1076               		.section	.progmem.data.__c.2249,"a",@progbits
 1079               	__c.2249:
 1080 0000 290A 00   		.string	")\n"
 1081               		.section	.progmem.data.__c.2247,"a",@progbits
 1084               	__c.2247:
 1085 0000 2575 00   		.string	"%u"
 1086               		.section	.progmem.data.__c.2245,"a",@progbits
 1089               	__c.2245:
 1090 0000 2F00      		.string	"/"
 1091               		.section	.progmem.data.__c.2243,"a",@progbits
 1094               	__c.2243:
 1095 0000 2575 00   		.string	"%u"
 1096               		.section	.progmem.data.__c.2241,"a",@progbits
 1099               	__c.2241:
 1100 0000 5D28 00   		.string	"]("
 1101               		.section	.progmem.data.__c.2239,"a",@progbits
 1104               	__c.2239:
 1105 0000 2564 00   		.string	"%d"
 1106               		.section	.progmem.data.__c.2237,"a",@progbits
 1109               	__c.2237:
 1110 0000 2000      		.string	" "
 1111               		.section	.progmem.data.__c.2235,"a",@progbits
 1114               	__c.2235:
 1115 0000 2564 00   		.string	"%d"
 1116               		.section	.progmem.data.__c.2233,"a",@progbits
 1119               	__c.2233:
 1120 0000 2000      		.string	" "
 1121               		.section	.progmem.data.__c.2231,"a",@progbits
 1124               	__c.2231:
 1125 0000 2564 00   		.string	"%d"
 1126               		.section	.progmem.data.__c.2229,"a",@progbits
 1129               	__c.2229:
 1130 0000 2000      		.string	" "
 1131               		.section	.progmem.data.__c.2227,"a",@progbits
 1134               	__c.2227:
 1135 0000 2564 00   		.string	"%d"
 1136               		.section	.progmem.data.__c.2225,"a",@progbits
 1139               	__c.2225:
 1140 0000 7C00      		.string	"|"
 1141               		.section	.progmem.data.__c.2223,"a",@progbits
 1144               	__c.2223:
 1145 0000 2530 3258 		.string	"%02X"
 1145      00
 1146               		.section	.progmem.data.__c.2221,"a",@progbits
 1149               	__c.2221:
 1150 0000 6D6F 7573 		.string	"mousekey [btn|x y v h](rep/acl): ["
 1150      656B 6579 
 1150      205B 6274 
 1150      6E7C 7820 
 1150      7920 7620 
 1151               	.global	mk_wheel_time_to_max
 1152               		.section	.data.mk_wheel_time_to_max,"aw",@progbits
 1155               	mk_wheel_time_to_max:
 1156 0000 28        		.byte	40
 1157               	.global	mk_wheel_max_speed
 1158               		.section	.data.mk_wheel_max_speed,"aw",@progbits
 1161               	mk_wheel_max_speed:
 1162 0000 08        		.byte	8
 1163               	.global	mk_time_to_max
 1164               		.section	.data.mk_time_to_max,"aw",@progbits
 1167               	mk_time_to_max:
 1168 0000 14        		.byte	20
 1169               	.global	mk_max_speed
 1170               		.section	.data.mk_max_speed,"aw",@progbits
 1173               	mk_max_speed:
 1174 0000 0A        		.byte	10
 1175               	.global	mk_interval
 1176               		.section	.data.mk_interval,"aw",@progbits
 1179               	mk_interval:
 1180 0000 32        		.byte	50
 1181               	.global	mk_delay
 1182               		.section	.data.mk_delay,"aw",@progbits
 1185               	mk_delay:
 1186 0000 1E        		.byte	30
 1187               		.section	.bss.last_timer,"aw",@nobits
 1190               	last_timer:
 1191 0000 0000      		.zero	2
 1192               		.section	.bss.mousekey_repeat,"aw",@nobits
 1195               	mousekey_repeat:
 1196 0000 00        		.zero	1
 1197               		.section	.bss.mousekey_accel,"aw",@nobits
 1200               	mousekey_accel:
 1201 0000 00        		.zero	1
 1202               		.section	.bss.mouse_report,"aw",@nobits
 1205               	mouse_report:
 1206 0000 0000 0000 		.zero	6
 1206      0000 
 1207               		.text
 1208               	.Letext0:
 1209               		.file 2 "/usr/lib/avr/include/stdint.h"
 1210               		.file 3 "tmk_core/common/report.h"
 1211               		.file 4 "tmk_core/common/debug.h"
 1212               		.file 5 "tmk_core/common/keycode.h"
 1213               		.file 6 "tmk_core/common/timer.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 mousekey.c
     /tmp/ccGzgbFq.s:2      *ABS*:000000000000003e __SP_H__
     /tmp/ccGzgbFq.s:3      *ABS*:000000000000003d __SP_L__
     /tmp/ccGzgbFq.s:4      *ABS*:000000000000003f __SREG__
     /tmp/ccGzgbFq.s:5      *ABS*:0000000000000000 __tmp_reg__
     /tmp/ccGzgbFq.s:6      *ABS*:0000000000000001 __zero_reg__
     /tmp/ccGzgbFq.s:12     .text.move_unit:0000000000000000 move_unit
     /tmp/ccGzgbFq.s:1200   .bss.mousekey_accel:0000000000000000 mousekey_accel
     /tmp/ccGzgbFq.s:1173   .data.mk_max_speed:0000000000000000 mk_max_speed
     /tmp/ccGzgbFq.s:1195   .bss.mousekey_repeat:0000000000000000 mousekey_repeat
     /tmp/ccGzgbFq.s:1167   .data.mk_time_to_max:0000000000000000 mk_time_to_max
     /tmp/ccGzgbFq.s:121    .text.wheel_unit:0000000000000000 wheel_unit
     /tmp/ccGzgbFq.s:1161   .data.mk_wheel_max_speed:0000000000000000 mk_wheel_max_speed
     /tmp/ccGzgbFq.s:1155   .data.mk_wheel_time_to_max:0000000000000000 mk_wheel_time_to_max
     /tmp/ccGzgbFq.s:219    .text.mousekey_on:0000000000000000 mousekey_on
     /tmp/ccGzgbFq.s:1205   .bss.mouse_report:0000000000000000 mouse_report
     /tmp/ccGzgbFq.s:401    .text.mousekey_off:0000000000000000 mousekey_off
     /tmp/ccGzgbFq.s:614    .text.mousekey_send:0000000000000000 mousekey_send
     /tmp/ccGzgbFq.s:1149   .progmem.data.__c.2221:0000000000000000 __c.2221
     /tmp/ccGzgbFq.s:1144   .progmem.data.__c.2223:0000000000000000 __c.2223
     /tmp/ccGzgbFq.s:1139   .progmem.data.__c.2225:0000000000000000 __c.2225
     /tmp/ccGzgbFq.s:1134   .progmem.data.__c.2227:0000000000000000 __c.2227
     /tmp/ccGzgbFq.s:1129   .progmem.data.__c.2229:0000000000000000 __c.2229
     /tmp/ccGzgbFq.s:1124   .progmem.data.__c.2231:0000000000000000 __c.2231
     /tmp/ccGzgbFq.s:1119   .progmem.data.__c.2233:0000000000000000 __c.2233
     /tmp/ccGzgbFq.s:1114   .progmem.data.__c.2235:0000000000000000 __c.2235
     /tmp/ccGzgbFq.s:1109   .progmem.data.__c.2237:0000000000000000 __c.2237
     /tmp/ccGzgbFq.s:1104   .progmem.data.__c.2239:0000000000000000 __c.2239
     /tmp/ccGzgbFq.s:1099   .progmem.data.__c.2241:0000000000000000 __c.2241
     /tmp/ccGzgbFq.s:1094   .progmem.data.__c.2243:0000000000000000 __c.2243
     /tmp/ccGzgbFq.s:1089   .progmem.data.__c.2245:0000000000000000 __c.2245
     /tmp/ccGzgbFq.s:1084   .progmem.data.__c.2247:0000000000000000 __c.2247
     /tmp/ccGzgbFq.s:1079   .progmem.data.__c.2249:0000000000000000 __c.2249
     /tmp/ccGzgbFq.s:1190   .bss.last_timer:0000000000000000 last_timer
     /tmp/ccGzgbFq.s:823    .text.mousekey_task:0000000000000000 mousekey_task
     /tmp/ccGzgbFq.s:1179   .data.mk_interval:0000000000000000 mk_interval
     /tmp/ccGzgbFq.s:1185   .data.mk_delay:0000000000000000 mk_delay
     /tmp/ccGzgbFq.s:1051   .text.mousekey_clear:0000000000000000 mousekey_clear

UNDEFINED SYMBOLS
__mulhi3
__divmodhi4
debug_config
xputs
__xprintf
host_mouse_send
timer_read
timer_elapsed
__do_copy_data
__do_clear_bss
